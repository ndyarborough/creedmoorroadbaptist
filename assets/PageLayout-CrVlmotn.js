import{j as r,r as g,m as E,n as R,d as w,o as L,p as $,q as F}from"./index-B2tQL_YW.js";import{F as D,H as O}from"./Button-Cm5R9cfv.js";const H=({children:e,className:t,as:a="p",variant:o,...s})=>{const l=[{"page-subheader":"page-subheader",body:"section-body",link:"text-link","footer-link":"footer-link","footer-copyright":"footer-copyright","nav-item":"nav-item","category-tag":"category-tag","tab-header":"tab-header"}[o],t].filter(Boolean).join(" ");return r.jsx(a,{className:l,...s,children:e})},x="pageHeader_",h="storageUrl_",U=30*60*1e3,b=30*60*1e3,v=e=>`${x}${e}`,p=e=>`${h}${e}`,_=e=>{try{const t=localStorage.getItem(v(e));return t?JSON.parse(t):null}catch{return null}},I=e=>{try{const t=localStorage.getItem(p(e));if(!t)return console.log("No cached URL found for",e),null;const{url:a,timestamp:o}=JSON.parse(t),s=Date.now()-o;return s>b?(console.log(`Cached URL expired for ${e} (age: ${Math.round(s/6e4)}min)`),localStorage.removeItem(p(e)),null):(console.log(`Using cached URL for ${e} (age: ${Math.round(s/6e4)}min)`),a)}catch(t){return console.error("Error reading cached URL:",t),null}},T=(e,t)=>{try{const a={data:t,timestamp:Date.now()};localStorage.setItem(v(e),JSON.stringify(a)),console.log("Saved page data to cache for",e)}catch(a){console.warn("Failed to save to cache:",a)}},A=(e,t)=>{try{const a={url:t,timestamp:Date.now()};localStorage.setItem(p(e),JSON.stringify(a)),console.log("Saved storage URL to cache for",e)}catch(a){console.warn("Failed to save storage URL to cache:",a)}},W=e=>{const t=Date.now()-e.timestamp,a=t<U;return console.log(`Cache age: ${Math.round(t/6e4)}min, valid: ${a}`),a},S=()=>{try{const e=Object.keys(localStorage),t=Date.now();let a=0;e.forEach(o=>{if(o.startsWith(x)||o.startsWith(h))try{const s=JSON.parse(localStorage.getItem(o)||"{}");if(s.timestamp){const n=o.startsWith(h)?b:U;t-s.timestamp>n&&(localStorage.removeItem(o),a++)}}catch{localStorage.removeItem(o),a++}}),a>0&&console.log(`Cleared ${a} expired cache entries`)}catch(e){console.warn("Failed to clear expired cache:",e)}};function k(e){const[t,a]=g.useState(null),[o,s]=g.useState(!0),[n,l]=g.useState(null);return g.useEffect(()=>{async function m(){try{s(!0),l(null),console.log(`Loading page header for: ${e}`);const c=_(e);if(c&&W(c)){console.log("Using cached page data for",e),console.log("Cached image URL:",c.data.imageUrl);const i=new Image;i.onload=()=>console.log("✅ Cached image URL is valid"),i.onerror=()=>{console.log("❌ Cached image URL is invalid, clearing cache and refetching"),J.clear(e),m()},i.src=c.data.imageUrl,a(c.data),s(!1);return}console.log("Fetching fresh data for",e);const y=await E(R(w,"pageHeaders",e));if(!y.exists()){console.log("No document found for",e),a(null),s(!1);return}const j=y.data();console.log("Document data:",j);const{header:N,subheader:C,imagePath:f}=j;let d=I(f);if(!d){console.log("Fetching fresh storage URL for",f);try{d=await L($(F,f)),console.log("Got storage URL:",d.substring(0,100)+"..."),A(f,d)}catch(i){throw console.error("Failed to get storage URL:",i),new Error(`Failed to load image: ${i}`)}}const u={header:N,subheader:C,imageUrl:d};console.log("Final page data:",{...u,imageUrl:u.imageUrl.substring(0,100)+"..."}),T(e,u),a(u)}catch(c){console.error("Error in usePageHeader:",c),l(c instanceof Error?c:new Error("Failed to load page header"))}finally{s(!1)}}m()},[e]),g.useEffect(()=>{S()},[]),{data:t,loading:o,error:n}}const J={clear:e=>{if(e)localStorage.removeItem(v(e)),console.log("Cleared cache for",e);else{const t=Object.keys(localStorage);let a=0;t.forEach(o=>{o.startsWith(x)&&(localStorage.removeItem(o),a++)}),console.log(`Cleared ${a} page header cache entries`)}},clearStorageUrls:e=>{if(e)localStorage.removeItem(p(e)),console.log("Cleared storage URL cache for",e);else{const t=Object.keys(localStorage);let a=0;t.forEach(o=>{o.startsWith(h)&&(localStorage.removeItem(o),a++)}),console.log(`Cleared ${a} storage URL cache entries`)}},clearAll:()=>{const e=Object.keys(localStorage);let t=0;e.forEach(a=>{(a.startsWith(x)||a.startsWith(h))&&(localStorage.removeItem(a),t++)}),console.log(`Cleared ${t} total cache entries`)},clearExpired:S,preload:async e=>{console.log("Preloading not implemented yet",e)}},M=({title:e,subtitle:t,imageUrl:a,banner:o,children:s})=>r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"w-full bg-cover bg-center text-white",style:{backgroundImage:`url("${a}")`},children:r.jsx("div",{className:"relative bg-black/50 flex flex-col justify-center text-center w-full h-80 md:h-96",children:r.jsxs(D,{direction:"col",gap:4,className:"px-8 text-left",children:[r.jsx(O,{variant:"page",children:e}),r.jsx(H,{variant:"page-subheader",children:t}),s&&r.jsx("div",{className:"mt-8 flex justify-center items-center gap-4",children:s})]})})}),o&&r.jsx("div",{className:"w-full absolute bottom-0 left-0 right-0 translate-y-3/4 lg:translate-y-1/2",children:o})]});function X({pageId:e,children:t,banner:a,heroActions:o}){const{data:s,loading:n,error:l}=k(e),m=a?"mt-32 lg:mt-16":"";return n?r.jsx("div",{className:"bg-bg-secondary",children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-dark"})})}):l?r.jsx("div",{className:"bg-bg-secondary",children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-600",children:"Failed to load page header"}),r.jsx("p",{className:"text-sm text-gray-500",children:l.message})]})})}):s?r.jsxs("div",{className:"bg-bg-secondary",children:[r.jsx(M,{title:s.header,subtitle:s.subheader,imageUrl:s.imageUrl,banner:a,children:o}),r.jsx("main",{className:m,children:t})]}):r.jsx("div",{className:"bg-bg-secondary",children:r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("p",{className:"text-gray-500",children:"No page header data found"})})})}export{X as P,H as T};
